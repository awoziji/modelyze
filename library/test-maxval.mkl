


include HybridSimulation


let maxval input:Signal -> maxout:Signal -> Equations =
  let Up:State in
  let Down:State in

  statechart initstate Up begin
     state Up begin
       input = maxout;
       transition Down when (input' <= 0.) 
          action nothing
     end;

     state Down begin
       maxout' = 0.;
       transition Up when (input' >= 0.) 
         action nothing
     end
  end


let test =
  let m:Signal in
  let x:Signal in
  let y:Signal in
  y = (sin (x*20.)) * x;
  maxval y m;

  x' = 0.7;

  probe "y" = y; 
  probe "maxval" = m

let main = printsim test 0.01 5.